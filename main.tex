%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%	COPYRIGHT THEO WINDEBANK
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[11pt,a4paper,fleqn]{article}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry}
\usepackage{graphicx}	        	% figures
\usepackage[titles]{tocloft}        % TOC formatting
\usepackage{subfig}			        % subfigures
\usepackage{wrapfig}		        % wrap text around figs
\graphicspath{{assets/figs/}}
\usepackage{pdfpages}               % import declaration
\usepackage[nodisplayskipstretch]{setspace} % smaller equation spacing
\usepackage{bold-extra}
\usepackage{titlesec}
\usepackage{titletoc}
%\usepackage{blindtext}              % lorem ipsum
\usepackage{tikz}
\usepackage{environ}
\usepackage{fontspec}
\usepackage{siunitx}
\sisetup{
    mode = math,
    math-rm=\mathsf
  }               % sans serif font
\usepackage{pifont}                 % ticks and crosses
\usepackage{amsmath}
\usepackage{amssymb}                % maths symbols
\usepackage[draft]{todonotes}       % for fun todo notes  
\usepackage[toc,page]{appendix}     % appendix
\usepackage{pdflscape}               % sideways table
\usepackage[11pt]{moresize}         % ssmall font size
% \usepackage[ruled,linesnumbered]{algorithm2e}  % algorithm typesetting
\usepackage{minted}
% [frame=lines,
% framesep=2mm,
% baselinestretch=1.2,
% bgcolor=LightGray,
% fontsize=\footnotesize,
% linenos]
%----------------------------------------------------------------------------------------
%	BIBLIOGRAPHY
%----------------------------------------------------------------------------------------
\usepackage[backend=biber,citestyle=numeric,bibstyle=ieee,sorting=none,doi=false,isbn=false,url=false,mincitenames=1,maxcitenames=2]{biblatex}
\addbibresource{mendeley.bib}
% preserve case of titles
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \step[fieldsource=title, match=\regexp{([A-Z]{1,})}, replace={{}{$1}}]
    }
  }
}

%----------------------------------------------------------------------------------------
%	FORMATTING
%----------------------------------------------------------------------------------------
% fonts
\setmainfont[%
Path=assets/fonts/,%
Extension = .ttf,%
UprightFont = *,%
BoldFont = *_Bold,%
ItalicFont = *_Italic,%
BoldItalicFont = *_Bold_Italic%
]{Arial}

% general doc stuff
\def \doublespaceheight {1.97}
\def \singlespaceheight {1.0}
\linespread{\doublespaceheight}
\renewcommand{\doublespacing}{\renewcommand{\baselinestretch}{\doublespaceheight}\normalsize}

\setcounter{tocdepth}{4}
\setcounter{secnumdepth}{4}
\renewcommand{\thepart}{\textbf{Section \Roman{part}:}\ }
\titleformat{\part}[block]{\LARGE\bfseries}{\thepart}{0pt}{}
% SPACING
% title headings
\titlespacing{\part}{0pt}{0pt plus 2pt minus 2pt}{0pt plus 2pt minus 2pt}[0pt]
\titlespacing{\section}{0pt}{0pt plus 2pt minus 2pt}{0pt plus 2pt minus 2pt}[0pt]
\titlespacing{\subsection}{0pt}{4pt plus 2pt minus 2pt}{0pt plus 2pt minus 2pt}[0pt]
\titlespacing{\subsubsection}{0pt}{2pt plus 2pt minus 2pt}{0pt plus 2pt minus 2pt}[0pt]

% single space box
\newcommand{\singlespacebox}[1]{

\noindent
\vspace{-\baselineskip}
    {\singlespacing
        #1
    }
}

% less padding for equations
\NewEnviron{talign}{
    \singlespacebox{
        \begin{align}
            \BODY\
        \end{align}
    }\hspace{-5pt}
}
\NewEnviron{tgather}{
    \singlespacebox{
        \begin{gather}
            \BODY\
        \end{gather}
    }\hspace{-5pt}
}

% figs
\setlength{\textfloatsep}{6.0pt plus 2.0pt minus 2.0pt}
\setlength{\intextsep}{6.0pt plus 2.0pt minus 2.0pt}

% table padding
\renewcommand{\arraystretch}{1.2}

% algebra formatting
\newcommand{\matr}[1]{\mathbf{#1}}
\newcommand{\argmax}{\arg\!\max}
\newcommand{\argmin}{\arg\!\min}


%----------------------------------------------------------------------------------------
%	DIAGRAM FORMATS
%----------------------------------------------------------------------------------------
\usetikzlibrary{positioning,arrows,backgrounds,fit}
\definecolor{azure}{rgb}{0.0, 0.5, 1.0}
\definecolor{amber}{rgb}{1.0, 0.49, 0.0}
\definecolor{blush}{rgb}{0.87, 0.36, 0.51}
\definecolor{cadmiumgreen}{rgb}{0.0, 0.42, 0.24}
\definecolor{caribbeangreen}{rgb}{0.0, 0.8, 0.6}
\definecolor{darkbyzantium}{rgb}{0.36, 0.22, 0.33}
\definecolor{darkmagenta}{rgb}{0.55, 0.0, 0.55}
\definecolor{darktangerine}{rgb}{1.0, 0.66, 0.07}
\tikzstyle{green} = [rectangle, rounded corners,text centered,  draw=green!50, fill=green!20,text=black,inner sep = 0.2cm]
\tikzstyle{blue} = [rectangle, rounded corners, text centered, draw=azure!70, fill=azure!50,inner sep = 0.2cm]
\tikzstyle{grey} = [rectangle, rounded corners, text centered, draw=black!50, fill=black!20,inner sep = 0.2cm]
\tikzstyle{orange} = [rectangle, rounded corners, text centered, draw=amber!50, fill=amber!40,inner sep = 0.2cm]
\tikzstyle{blank} = [rectangle, rounded corners, text centered,inner sep = 0.5mm]
\tikzstyle{blankdot} = [rectangle, rounded corners, text centered,inner sep = 0cm]
\tikzstyle{arrow} = [thin,->,>=stealth,draw=black!50]
\tikzstyle{orangearrow} = [thin,->,>=stealth,draw=amber!70]
\tikzstyle{purplearrow} = [thin,->,>=stealth,draw=darkmagenta!50]
%----------------------------------------------------------------------------------------
%	CUSTOM COMMANDS
%----------------------------------------------------------------------------------------

% FUN TODO NOTES
\makeatletter
\renewcommand{\todo}[2][]{%
    \@todo[caption={#2}, #1]{\begin{spacing}{0.5}#2\end{spacing}}%
} 
\makeatother

\newcommand{\twN}[1]{\todo[inline, size=\small, color=green!30]{[tw] #1}}
\newcommand{\twn}[1]{\todo[color=green!30]{[tw] #1}}

% NEW LINES IN TABLE CELLS/TIKZ NODES
\newcommand{\specialcell}[2][l]{%
	\begin{tabular}[#1]{@{}l@{}}#2\end{tabular}}


\newcommand{\addsubsec}[2]{%
    \graphicspath{{./sections/#1/figs/}}
    \IfFileExists{sections/#1/#2.tex}{\input{sections/#1/#2.tex}}
    
    }
    
%\newcommand{\checkmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%
    
\newenvironment{sitemize}
{ \begin{itemize}
    \setlength{\itemsep}{0pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}     }
{ \end{itemize}                  }


\NewEnviron{tikzfig}[3]{
\begin{figure}[ht]
    \linespread{\singlespaceheight}
    \begin{centering}
        \small
    	\begin{tikzpicture}[font=#3\sffamily]
            \BODY\
        \end{tikzpicture}
        \caption{#2}
        \label{#1}
    \end{centering}
\end{figure}
}

\newcommand{\code}[1]{\texttt{#1}}
% \NewDocumentEnvironment{tikzfig}{m}{%
%  %
% }{%     
%           }

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\newcommand*{\titleGP}{\begingroup % Create the command for including the title page in the document
	\centering % Center all text
	\linespread{\singlespaceheight}
	\uppercase
	{\huge Department of Engineering Science \\ University of Oxford \\ \vspace{0.5cm} Fourth Year Project \par} % Editor affiliation
	\vspace{1cm}
	
	\includegraphics[width=0.4\textwidth]{ox_logo.eps}
	\vspace{1cm}
	
	\rule{\textwidth}{1.6pt}\vspace*{-\baselineskip}\vspace*{2pt} % Thick horizontal line
	\rule{\textwidth}{0.4pt}\\[0.5\baselineskip] % Thin horizontal line
	
	% TITLE
	{\setstretch{2.0} \LARGE DECISION ANALYTICS FOR BIOACOUSTIC MONITORING}
	
	\rule{\textwidth}{0.4pt}\vspace*{-\baselineskip}\vspace{3.2pt} % Thin horizontal line
	\rule{\textwidth}{1.6pt}\\[\baselineskip] % Thick horizontal line

	{\large AUTHOR \\ \Large THEO WINDEBANK \\\vspace{0.5cm} \large SUPERVISOR \Large \\ STEVE ROBERTS\par} % Editor list
	

	\vspace{0.5cm}
	\endgroup}

%----------------------------------------------------------------------------------------
% DOCUMENT
%----------------------------------------------------------------------------------------

\begin{document} 	
    %%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%% TITLE %%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%
    \newgeometry{left=3cm,right=3cm,top=3cm,bottom=3cm} 
    \pagenumbering{gobble}
	\titleGP % This command includes the title page
	\clearpage
   
    \restoregeometry
	
    %%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%% DECLARATION %%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%
    \pagenumbering{roman}
	\addsubsec{}{declaration}
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%% ABSTRACT+ACK %%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%
    \addsubsec{}{abstract}	
	\clearpage
	\addsubsec{}{acknowledgements}
	\clearpage
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%% CONTENTS TABLE %%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \renewcommand{\baselinestretch}{\singlespaceheight}\normalsize
    \tableofcontents
    \clearpage
    \pagenumbering{arabic}
    \renewcommand{\baselinestretch}{\doublespaceheight}\normalsize
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%% SEC1: BACKGROUND %%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \part{Background}
    \label{part:background}
        \addsubsec{background}{introduction}
    	\addsubsec{background}{litreview}
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%% SEC2: PIPELINE %%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \part{Building a Pipeline}
    \label{part:pl}
        \addsubsec{pipeline}{overview}
        \addsubsec{pipeline}{mozzpy}
    	\addsubsec{pipeline}{data}
    	\addsubsec{pipeline}{gen_features}
    	\addsubsec{pipeline}{feat_preproc}
    	\addsubsec{pipeline}{classification}
    	\addsubsec{pipeline}{postprocessing}
    	\addsubsec{pipeline}{aggregation}
    	\addsubsec{pipeline}{testing}
    	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%% SEC3: EXPERIMENTS  %%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \part{Experimental Design and Testing}
    \label{part:exp}
        \addsubsec{exp}{overview}
        \addsubsec{exp}{specs}
        \addsubsec{exp}{classification}
        \addsubsec{exp}{postproc}
        \addsubsec{exp}{agg}
        \addsubsec{exp}{other}
        \addsubsec{exp}{summary}
        % \addsubsec{exp}{nb}
        % \addsubsec{exp}{svm}
        % \addsubsec{exp}{agg}
    
%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     %%%%%%%%%%%%%%%% SEC4: RESULTS  %%%%%%%%%%%%%%%%
%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 	\part{Results}
% 	\label{part:res}
% 	    \addsubsec{res}{best}
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%% SEC5: FURTHER WORK  %%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\part{Further Work and Conclusions}
	\label{part:conc}
	    \addsubsec{conc}{further}
	    \addsubsec{conc}{conclusion}
	\\
	\linespread{1.0}
	\printbibliography
	
	\begin{appendices}
	\label{part:appdx}
	    \addsubsec{}{appendix}
	\end{appendices}

	
\end{document}